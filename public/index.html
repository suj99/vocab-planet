<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>è¯æ±‡æ˜Ÿçƒ - æ¯æ—¥è‹±è¯­å­¦ä¹ </title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Noto+Sans+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #a5b4fc;
            --secondary: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-medium: 0 8px 30px rgba(0, 0, 0, 0.12);
            --radius: 16px;
            --radius-sm: 10px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans SC', 'Nunito', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
        }
        .bg-decoration { position: fixed; top: 0; left: 0; right: 0; bottom: 0; overflow: hidden; pointer-events: none; z-index: 0; }
        .bg-circle { position: absolute; border-radius: 50%; background: rgba(255, 255, 255, 0.1); animation: float 20s ease-in-out infinite; }
        .bg-circle:nth-child(1) { width: 300px; height: 300px; top: -100px; right: -50px; }
        .bg-circle:nth-child(2) { width: 200px; height: 200px; bottom: 10%; left: -50px; animation-delay: -5s; }
        .bg-circle:nth-child(3) { width: 150px; height: 150px; top: 40%; right: 10%; animation-delay: -10s; }
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-20px) rotate(5deg); } }

        /* ç™»å½•é¡µé¢ */
        .login-container {
            position: relative; z-index: 1; max-width: 400px; margin: 0 auto; padding: 20px;
            min-height: 100vh; display: flex; flex-direction: column; justify-content: center;
        }
        .login-card {
            background: var(--card-bg); border-radius: var(--radius); padding: 40px 30px;
            box-shadow: var(--shadow-medium); text-align: center;
        }
        .login-logo { font-size: 4rem; margin-bottom: 15px; }
        .login-title { font-size: 1.8rem; font-weight: 700; margin-bottom: 8px; }
        .login-subtitle { color: var(--text-secondary); margin-bottom: 30px; font-size: 0.95rem; }
        .login-input {
            width: 100%; padding: 14px 18px; border: 2px solid #e2e8f0; border-radius: var(--radius-sm);
            font-size: 1rem; margin-bottom: 15px; transition: border-color 0.3s;
        }
        .login-input:focus { outline: none; border-color: var(--primary); }
        .login-btn {
            width: 100%; padding: 14px; background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white; border: none; border-radius: var(--radius-sm); font-size: 1rem;
            font-weight: 600; cursor: pointer; transition: all 0.3s; margin-bottom: 15px;
        }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4); }
        .login-divider { display: flex; align-items: center; margin: 20px 0; color: var(--text-secondary); font-size: 0.85rem; }
        .login-divider::before, .login-divider::after { content: ''; flex: 1; height: 1px; background: #e2e8f0; }
        .login-divider span { padding: 0 15px; }
        .user-list { max-height: 200px; overflow-y: auto; margin-bottom: 15px; }
        .user-item {
            display: flex; align-items: center; justify-content: space-between; padding: 12px 15px;
            background: #f8fafc; border-radius: var(--radius-sm); margin-bottom: 8px;
            cursor: pointer; transition: all 0.3s;
        }
        .user-item:hover { background: #eef2ff; transform: translateX(5px); }
        .user-info { display: flex; align-items: center; gap: 12px; }
        .user-avatar {
            width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: white; font-weight: 700; font-size: 1.1rem;
        }
        .user-name { font-weight: 600; }
        .user-progress { font-size: 0.8rem; color: var(--text-secondary); }
        .user-delete { width: 30px; height: 30px; background: transparent; border: none; color: var(--danger); font-size: 1.2rem; cursor: pointer; opacity: 0.5; transition: opacity 0.3s; }
        .user-delete:hover { opacity: 1; }
        .no-users { color: var(--text-secondary); font-size: 0.9rem; padding: 20px; }

        /* ä¸»å®¹å™¨ */
        .app-container { position: relative; z-index: 1; max-width: 480px; margin: 0 auto; padding: 20px; min-height: 100vh; display: none; }
        .app-container.active { display: block; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 10px 0 20px; }
        .logo { display: flex; align-items: center; gap: 10px; }
        .logo-icon { width: 44px; height: 44px; background: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: var(--shadow-soft); }
        .logo-text { color: white; font-weight: 700; font-size: 1.3rem; }
        .header-right { display: flex; align-items: center; gap: 10px; }
        .user-badge { display: flex; align-items: center; gap: 8px; background: rgba(255, 255, 255, 0.2); padding: 6px 12px 6px 6px; border-radius: 25px; color: white; font-size: 0.9rem; cursor: pointer; transition: all 0.3s; backdrop-filter: blur(10px); }
        .user-badge:hover { background: rgba(255, 255, 255, 0.3); }
        .user-badge .mini-avatar { width: 28px; height: 28px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary); font-weight: 700; font-size: 0.85rem; }
        .settings-btn { width: 44px; height: 44px; background: rgba(255, 255, 255, 0.2); border: none; border-radius: 12px; color: white; font-size: 20px; cursor: pointer; transition: all 0.3s; backdrop-filter: blur(10px); }
        .settings-btn:hover { background: rgba(255, 255, 255, 0.3); transform: rotate(45deg); }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-card { background: var(--card-bg); border-radius: var(--radius); padding: 20px; margin-bottom: 20px; box-shadow: var(--shadow-medium); }
        .stats-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .stats-title { font-size: 0.9rem; color: var(--text-secondary); }
        .streak-badge { background: linear-gradient(135deg, #f59e0b, #f97316); color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; display: flex; align-items: center; gap: 4px; }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .stat-item { text-align: center; }
        .stat-value { font-size: 1.8rem; font-weight: 800; color: var(--primary); font-family: 'Nunito', sans-serif; }
        .stat-label { font-size: 0.8rem; color: var(--text-secondary); margin-top: 2px; }
        .progress-section { margin-top: 15px; padding-top: 15px; border-top: 1px solid #e2e8f0; }
        .progress-header { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.85rem; }
        .progress-bar { height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--primary-light)); border-radius: 4px; transition: width 0.5s ease; }

        /* å¯¼èˆªæ ‡ç­¾ */
        .nav-tabs { display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; -webkit-overflow-scrolling: touch; }
        .nav-tabs::-webkit-scrollbar { display: none; }
        .nav-tab { flex-shrink: 0; padding: 10px 18px; background: rgba(255, 255, 255, 0.2); border: none; border-radius: 25px; color: white; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s; backdrop-filter: blur(10px); }
        .nav-tab.active { background: white; color: var(--primary); box-shadow: var(--shadow-soft); }
        .nav-tab:hover:not(.active) { background: rgba(255, 255, 255, 0.35); }
        .content-section { display: none; }
        .content-section.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* å­¦ä¹ å¡ç‰‡ */
        .word-card { background: var(--card-bg); border-radius: var(--radius); padding: 30px 25px; text-align: center; box-shadow: var(--shadow-medium); margin-bottom: 20px; position: relative; overflow: hidden; }
        .word-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--primary), var(--secondary)); }
        .word-progress { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 20px; }
        .word-english { font-family: 'Nunito', sans-serif; font-size: 2.5rem; font-weight: 800; color: var(--text-primary); margin-bottom: 8px; }
        .word-phonetic { font-size: 1.1rem; color: var(--primary); margin-bottom: 15px; font-family: 'Nunito', sans-serif; }
        .word-chinese { font-size: 1.4rem; color: var(--text-primary); margin-bottom: 20px; font-weight: 600; }
        .word-category { display: inline-block; padding: 4px 12px; background: #f1f5f9; border-radius: 15px; font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 20px; }
        .example-sentence { background: #f8fafc; border-radius: var(--radius-sm); padding: 15px; margin-top: 15px; text-align: left; }
        .example-label { font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        .example-english { font-family: 'Nunito', sans-serif; font-size: 1rem; color: var(--text-primary); margin-bottom: 5px; line-height: 1.5; }
        .example-english .highlight { color: var(--primary); font-weight: 700; }
        .example-chinese { font-size: 0.9rem; color: var(--text-secondary); }
        .speak-btn { width: 44px; height: 44px; background: var(--primary-light); border: none; border-radius: 50%; color: var(--primary-dark); font-size: 1.2rem; cursor: pointer; transition: all 0.3s; margin-bottom: 15px; }
        .speak-btn:hover { background: var(--primary); color: white; transform: scale(1.1); }

        /* æŒ‰é’® */
        .button-group { display: flex; gap: 12px; }
        .btn { flex: 1; padding: 14px 20px; border: none; border-radius: var(--radius-sm); font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(99, 102, 241, 0.5); }
        .btn-secondary { background: #f1f5f9; color: var(--text-primary); }
        .btn-secondary:hover { background: #e2e8f0; }

        /* æƒ…æ™¯æ¨¡å— */
        .scenario-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .scenario-card { background: var(--card-bg); border-radius: var(--radius); padding: 20px 15px; text-align: center; cursor: pointer; transition: all 0.3s; box-shadow: var(--shadow-soft); position: relative; overflow: hidden; }
        .scenario-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-medium); }
        .scenario-icon { font-size: 2.5rem; margin-bottom: 10px; }
        .scenario-name { font-weight: 600; font-size: 1rem; margin-bottom: 5px; }
        .scenario-count { font-size: 0.8rem; color: var(--text-secondary); }
        .scenario-progress { position: absolute; bottom: 0; left: 0; height: 3px; background: var(--primary); transition: width 0.3s; }

        /* ç»ƒä¹  */
        .quiz-card { background: var(--card-bg); border-radius: var(--radius); padding: 25px; box-shadow: var(--shadow-medium); margin-bottom: 20px; }
        .quiz-type { font-size: 0.8rem; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 15px; font-weight: 600; }
        .quiz-question { font-size: 1.2rem; margin-bottom: 20px; line-height: 1.6; }
        .quiz-question .blank { display: inline-block; min-width: 80px; border-bottom: 2px dashed var(--primary); margin: 0 5px; }
        .quiz-options { display: flex; flex-direction: column; gap: 10px; }
        .quiz-option { padding: 14px 18px; background: #f8fafc; border: 2px solid transparent; border-radius: var(--radius-sm); cursor: pointer; transition: all 0.3s; font-size: 1rem; text-align: left; }
        .quiz-option:hover { background: #f1f5f9; border-color: var(--primary-light); }
        .quiz-option.selected { border-color: var(--primary); background: #eef2ff; }
        .quiz-option.correct { border-color: var(--success); background: #ecfdf5; }
        .quiz-option.wrong { border-color: var(--danger); background: #fef2f2; }

        /* é˜…è¯» */
        .reading-card { background: var(--card-bg); border-radius: var(--radius); padding: 25px; box-shadow: var(--shadow-medium); margin-bottom: 20px; }
        .reading-title { font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .reading-level { display: inline-block; padding: 3px 10px; background: var(--primary-light); color: var(--primary-dark); border-radius: 12px; font-size: 0.75rem; font-weight: 600; margin-bottom: 15px; }
        .reading-content { font-size: 1rem; line-height: 1.8; color: var(--text-primary); }
        .reading-content .vocab-word { color: var(--primary); font-weight: 600; cursor: pointer; border-bottom: 1px dotted var(--primary); }

        /* è®¾ç½®é¢æ¿ */
        .settings-panel { position: fixed; top: 0; right: -100%; width: 100%; max-width: 400px; height: 100%; background: white; z-index: 1000; transition: right 0.3s ease; overflow-y: auto; }
        .settings-panel.open { right: 0; }
        .settings-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 999; opacity: 0; visibility: hidden; transition: all 0.3s; }
        .settings-overlay.open { opacity: 1; visibility: visible; }
        .settings-header { padding: 20px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        .settings-title { font-size: 1.2rem; font-weight: 700; }
        .close-btn { width: 36px; height: 36px; background: #f1f5f9; border: none; border-radius: 50%; font-size: 1.2rem; cursor: pointer; transition: all 0.3s; }
        .close-btn:hover { background: #e2e8f0; }
        .settings-content { padding: 20px; }
        .setting-group { margin-bottom: 25px; }
        .setting-label { font-weight: 600; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .setting-description { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 10px; }
        .setting-input { width: 100%; padding: 12px 15px; border: 2px solid #e2e8f0; border-radius: var(--radius-sm); font-size: 1rem; transition: border-color 0.3s; }
        .setting-input:focus { outline: none; border-color: var(--primary); }
        .setting-slider { width: 100%; height: 6px; -webkit-appearance: none; background: #e2e8f0; border-radius: 3px; outline: none; }
        .setting-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; background: var(--primary); border-radius: 50%; cursor: pointer; }
        .slider-value { text-align: center; margin-top: 8px; font-weight: 600; color: var(--primary); }
        .logout-section { margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0; }
        .logout-btn { width: 100%; padding: 12px; background: #fef2f2; color: var(--danger); border: none; border-radius: var(--radius-sm); font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .logout-btn:hover { background: #fee2e2; }

        /* è¯æ±‡æç¤º */
        .vocab-tooltip { position: fixed; background: white; padding: 15px; border-radius: var(--radius-sm); box-shadow: var(--shadow-medium); z-index: 100; max-width: 280px; display: none; }
        .vocab-tooltip.show { display: block; animation: tooltipIn 0.2s ease; }
        @keyframes tooltipIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .tooltip-word { font-family: 'Nunito', sans-serif; font-size: 1.2rem; font-weight: 700; color: var(--primary); }
        .tooltip-phonetic { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 5px; }
        .tooltip-meaning { font-size: 0.95rem; }

        /* å®Œæˆå¼¹çª— */
        .completion-modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; z-index: 1001; opacity: 0; visibility: hidden; transition: all 0.3s; }
        .completion-modal.show { opacity: 1; visibility: visible; }
        .completion-content { background: white; border-radius: var(--radius); padding: 40px 30px; text-align: center; max-width: 340px; transform: scale(0.8); transition: transform 0.3s; }
        .completion-modal.show .completion-content { transform: scale(1); }
        .completion-icon { font-size: 4rem; margin-bottom: 20px; }
        .completion-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 10px; }
        .completion-message { color: var(--text-secondary); margin-bottom: 25px; }
        .completion-stats { display: flex; justify-content: center; gap: 30px; margin-bottom: 25px; }
        .completion-stat { text-align: center; }
        .completion-stat-value { font-size: 2rem; font-weight: 800; color: var(--primary); }
        .completion-stat-label { font-size: 0.8rem; color: var(--text-secondary); }

        @media (max-width: 380px) { .app-container { padding: 15px; } .word-english { font-size: 2rem; } .scenario-grid { gap: 10px; } }
    </style>
</head>
<body>
    <div class="bg-decoration"><div class="bg-circle"></div><div class="bg-circle"></div><div class="bg-circle"></div></div>

    <!-- ç™»å½•é¡µé¢ -->
    <div class="login-container" id="loginContainer">
        <div class="login-card">
            <div class="login-logo">ğŸ“š</div>
            <div class="login-title">è¯æ±‡æ˜Ÿçƒ</div>
            <div class="login-subtitle">æ¯å¤©15åˆ†é’Ÿï¼Œè½»æ¾æŒæ¡3000è¯</div>
            <input type="text" class="login-input" id="usernameInput" placeholder="è¾“å…¥ä½ çš„åå­—" maxlength="10">
            <button class="login-btn" onclick="createOrLoginUser()">å¼€å§‹å­¦ä¹ </button>
            <div class="login-divider"><span>æˆ–é€‰æ‹©å·²æœ‰è´¦æˆ·</span></div>
            <div class="user-list" id="userList"><div class="no-users">è¿˜æ²¡æœ‰ç”¨æˆ·ï¼Œåˆ›å»ºä¸€ä¸ªå§ï¼</div></div>
        </div>
    </div>

    <!-- ä¸»åº”ç”¨ -->
    <div class="app-container" id="appContainer">
        <header class="header">
            <div class="logo"><div class="logo-icon">ğŸ“š</div><span class="logo-text">è¯æ±‡æ˜Ÿçƒ</span></div>
            <div class="header-right">
                <div class="user-badge" onclick="toggleSettings()"><div class="mini-avatar" id="headerAvatar">T</div><span id="headerUsername">Tom</span></div>
                <button class="settings-btn" onclick="toggleSettings()">âš™ï¸</button>
            </div>
        </header>

        <div class="stats-card">
            <div class="stats-header"><span class="stats-title">å­¦ä¹ è¿›åº¦</span><div class="streak-badge"><span>ğŸ”¥</span><span id="streakDays">0</span>å¤©è¿ç»­</div></div>
            <div class="stats-grid">
                <div class="stat-item"><div class="stat-value" id="learnedCount">0</div><div class="stat-label">å·²å­¦å•è¯</div></div>
                <div class="stat-item"><div class="stat-value" id="masteredCount">0</div><div class="stat-label">å·²æŒæ¡</div></div>
                <div class="stat-item"><div class="stat-value" id="todayCount">0</div><div class="stat-label">ä»Šæ—¥å­¦ä¹ </div></div>
            </div>
            <div class="progress-section">
                <div class="progress-header"><span>æ€»ä½“è¿›åº¦</span><span><span id="progressPercent">0</span>%</span></div>
                <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width: 0%"></div></div>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="learn" onclick="switchTab('learn')">ğŸ“– ä»Šæ—¥å­¦ä¹ </button>
            <button class="nav-tab" data-tab="scenario" onclick="switchTab('scenario')">ğŸ­ æƒ…æ™¯ç»ƒä¹ </button>
            <button class="nav-tab" data-tab="quiz" onclick="switchTab('quiz')">âœï¸ å·©å›ºç»ƒä¹ </button>
            <button class="nav-tab" data-tab="reading" onclick="switchTab('reading')">ğŸ“° è¶£å‘³é˜…è¯»</button>
        </div>

        <div class="content-section active" id="section-learn">
            <div class="word-card" id="wordCard">
                <div class="word-progress">ç¬¬ <span id="currentWordIndex">1</span> / <span id="totalWords">15</span> ä¸ªå•è¯</div>
                <button class="speak-btn" onclick="speakWord()">ğŸ”Š</button>
                <div class="word-english" id="wordEnglish">hello</div>
                <div class="word-phonetic" id="wordPhonetic">/hÉ™ËˆloÊŠ/</div>
                <div class="word-chinese" id="wordChinese">ä½ å¥½ï¼›å–‚</div>
                <div class="word-category" id="wordCategory">æ—¥å¸¸é—®å€™</div>
                <div class="example-sentence">
                    <div class="example-label">ä¾‹å¥</div>
                    <div class="example-english" id="exampleEnglish"><span class="highlight">Hello</span>, how are you today?</div>
                    <div class="example-chinese" id="exampleChinese">ä½ å¥½ï¼Œä½ ä»Šå¤©æ€ä¹ˆæ ·ï¼Ÿ</div>
                </div>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="markWord('hard')">ğŸ˜° ä¸è®¤è¯†</button>
                <button class="btn btn-primary" onclick="markWord('know')">ğŸ˜Š è®¤è¯†äº†</button>
            </div>
        </div>

        <div class="content-section" id="section-scenario">
            <div class="scenario-grid">
                <div class="scenario-card" onclick="startScenario('greetings')"><div class="scenario-icon">ğŸ‘‹</div><div class="scenario-name">é—®å€™ä¸ä»‹ç»</div><div class="scenario-count">15ä¸ªè¯æ±‡</div><div class="scenario-progress" style="width: 0%"></div></div>
                <div class="scenario-card" onclick="startScenario('weather')"><div class="scenario-icon">ğŸŒ¤ï¸</div><div class="scenario-name">å¤©æ°”è¯é¢˜</div><div class="scenario-count">15ä¸ªè¯æ±‡</div><div class="scenario-progress" style="width: 0%"></div></div>
                <div class="scenario-card" onclick="startScenario('restaurant')"><div class="scenario-icon">ğŸ½ï¸</div><div class="scenario-name">é¤å…ç‚¹é¤</div><div class="scenario-count">15ä¸ªè¯æ±‡</div><div class="scenario-progress" style="width: 0%"></div></div>
                <div class="scenario-card" onclick="startScenario('directions')"><div class="scenario-icon">ğŸ—ºï¸</div><div class="scenario-name">é—®è·¯æŒ‡è·¯</div><div class="scenario-count">15ä¸ªè¯æ±‡</div><div class="scenario-progress" style="width: 0%"></div></div>
                <div class="scenario-card" onclick="startScenario('shopping')"><div class="scenario-icon">ğŸ›’</div><div class="scenario-name">è´­ç‰©æ¶ˆè´¹</div><div class="scenario-count">15ä¸ªè¯æ±‡</div><div class="scenario-progress" style="width: 0%"></div></div>
            </div>
        </div>

        <div class="content-section" id="section-quiz">
            <div class="quiz-card">
                <div class="quiz-type">å¡«ç©ºç»ƒä¹ </div>
                <div class="quiz-question"><span id="quizSentence">I want to <span class="blank"></span> a cup of coffee.</span></div>
                <div class="quiz-options" id="quizOptions"></div>
            </div>
            <div class="button-group">
                <button class="btn btn-secondary" onclick="skipQuiz()">è·³è¿‡</button>
                <button class="btn btn-primary" onclick="checkAnswer()">ç¡®è®¤ç­”æ¡ˆ</button>
            </div>
        </div>

        <div class="content-section" id="section-reading">
            <div class="reading-card">
                <div class="reading-title">The Lost Key ä¸¢å¤±çš„é’¥åŒ™</div>
                <span class="reading-level">åˆçº§ Â· 50è¯</span>
                <div class="reading-content">
                    <p>Tom <span class="vocab-word" data-word="lost" data-phonetic="/lÉ”Ëst/" data-meaning="ä¸¢å¤±">lost</span> his key. He looked in his <span class="vocab-word" data-word="pocket" data-phonetic="/ËˆpÉ’kÉªt/" data-meaning="å£è¢‹">pocket</span>. No key. He looked on the <span class="vocab-word" data-word="table" data-phonetic="/ËˆteÉªbl/" data-meaning="æ¡Œå­">table</span>. No key. Then his dog came. The key was in the dog's <span class="vocab-word" data-word="mouth" data-phonetic="/maÊŠÎ¸/" data-meaning="å˜´">mouth</span>!</p>
                    <p style="margin-top: 15px; color: var(--text-secondary); font-size: 0.9rem;">æ±¤å§†ä¸¢äº†ä»–çš„é’¥åŒ™ã€‚ä»–æ‰¾äº†æ‰¾å£è¢‹ï¼Œæ²¡æœ‰ã€‚ä»–çœ‹äº†çœ‹æ¡Œå­ï¼Œä¹Ÿæ²¡æœ‰ã€‚ç„¶åä»–çš„ç‹—æ¥äº†ã€‚é’¥åŒ™åœ¨ç‹—å˜´é‡Œï¼</p>
                </div>
            </div>
        </div>
    </div>

    <!-- è®¾ç½®é¢æ¿ -->
    <div class="settings-overlay" id="settingsOverlay" onclick="toggleSettings()"></div>
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header"><span class="settings-title">âš™ï¸ å­¦ä¹ è®¾ç½®</span><button class="close-btn" onclick="toggleSettings()">âœ•</button></div>
        <div class="settings-content">
            <div class="setting-group"><label class="setting-label">ğŸ‘¤ å½“å‰ç”¨æˆ·</label><p class="setting-description">ä½ æ­£åœ¨ä»¥ <strong id="settingsUsername">ç”¨æˆ·</strong> çš„èº«ä»½å­¦ä¹ </p></div>
            <div class="setting-group">
                <label class="setting-label">ğŸ“ æ¯æ—¥å­¦ä¹ å•è¯æ•°</label>
                <input type="range" class="setting-slider" id="dailyWordsSlider" min="5" max="30" value="15" oninput="updateSliderValue(this.value)">
                <div class="slider-value"><span id="dailyWordsValue">15</span> ä¸ªå•è¯/å¤©</div>
            </div>
            <div class="setting-group">
                <label class="setting-label">ğŸ”Š å‘éŸ³è®¾ç½®</label>
                <select class="setting-input" id="accent"><option value="us" selected>ç¾å¼å‘éŸ³</option><option value="uk">è‹±å¼å‘éŸ³</option></select>
            </div>
            <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="saveSettings()">ğŸ’¾ ä¿å­˜è®¾ç½®</button>
            <div class="logout-section"><button class="logout-btn" onclick="logout()">ğŸšª åˆ‡æ¢ç”¨æˆ·</button></div>
        </div>
    </div>

    <div class="vocab-tooltip" id="vocabTooltip"><div class="tooltip-word" id="tooltipWord"></div><div class="tooltip-phonetic" id="tooltipPhonetic"></div><div class="tooltip-meaning" id="tooltipMeaning"></div></div>

    <div class="completion-modal" id="completionModal">
        <div class="completion-content">
            <div class="completion-icon">ğŸ‰</div>
            <div class="completion-title">å¤ªæ£’äº†ï¼</div>
            <div class="completion-message">ä½ å®Œæˆäº†ä»Šå¤©çš„å­¦ä¹ ä»»åŠ¡</div>
            <div class="completion-stats">
                <div class="completion-stat"><div class="completion-stat-value" id="completionNew">15</div><div class="completion-stat-label">æ–°å­¦å•è¯</div></div>
                <div class="completion-stat"><div class="completion-stat-value" id="completionReview">8</div><div class="completion-stat-label">å¤ä¹ å•è¯</div></div>
            </div>
            <button class="btn btn-primary" style="width: 100%;" onclick="closeCompletion()">ç»§ç»­å­¦ä¹ </button>
        </div>
    </div>

    <script>
        // è¯åº“
        const vocabulary = {
            greetings: [
                { word: "hello", phonetic: "/hÉ™ËˆloÊŠ/", chinese: "ä½ å¥½ï¼›å–‚", category: "æ—¥å¸¸é—®å€™", example: "Hello, how are you today?", exampleCn: "ä½ å¥½ï¼Œä½ ä»Šå¤©æ€ä¹ˆæ ·ï¼Ÿ" },
                { word: "goodbye", phonetic: "/É¡ÊŠdËˆbaÉª/", chinese: "å†è§", category: "æ—¥å¸¸é—®å€™", example: "Goodbye! See you tomorrow.", exampleCn: "å†è§ï¼æ˜å¤©è§ã€‚" },
                { word: "thank", phonetic: "/Î¸Ã¦Å‹k/", chinese: "è°¢è°¢", category: "æ—¥å¸¸é—®å€™", example: "Thank you for your help.", exampleCn: "è°¢è°¢ä½ çš„å¸®åŠ©ã€‚" },
                { word: "please", phonetic: "/pliËz/", chinese: "è¯·", category: "æ—¥å¸¸é—®å€™", example: "Please sit down.", exampleCn: "è¯·åã€‚" },
                { word: "sorry", phonetic: "/ËˆsÉ’ri/", chinese: "å¯¹ä¸èµ·", category: "æ—¥å¸¸é—®å€™", example: "I'm sorry for being late.", exampleCn: "å¯¹ä¸èµ·æˆ‘è¿Ÿåˆ°äº†ã€‚" },
                { word: "welcome", phonetic: "/ËˆwelkÉ™m/", chinese: "æ¬¢è¿", category: "æ—¥å¸¸é—®å€™", example: "Welcome to my home!", exampleCn: "æ¬¢è¿æ¥åˆ°æˆ‘å®¶ï¼" },
                { word: "morning", phonetic: "/ËˆmÉ”ËnÉªÅ‹/", chinese: "æ—©ä¸Š", category: "æ—¶é—´", example: "Good morning!", exampleCn: "æ—©ä¸Šå¥½ï¼" },
                { word: "afternoon", phonetic: "/ËŒÉ‘ËftÉ™rËˆnuËn/", chinese: "ä¸‹åˆ", category: "æ—¶é—´", example: "See you this afternoon.", exampleCn: "ä¸‹åˆè§ã€‚" },
                { word: "evening", phonetic: "/ËˆiËvnÉªÅ‹/", chinese: "æ™šä¸Š", category: "æ—¶é—´", example: "Good evening!", exampleCn: "æ™šä¸Šå¥½ï¼" },
                { word: "night", phonetic: "/naÉªt/", chinese: "å¤œæ™š", category: "æ—¶é—´", example: "Good night!", exampleCn: "æ™šå®‰ï¼" },
                { word: "today", phonetic: "/tÉ™ËˆdeÉª/", chinese: "ä»Šå¤©", category: "æ—¶é—´", example: "What day is today?", exampleCn: "ä»Šå¤©æ˜¯æ˜ŸæœŸå‡ ï¼Ÿ" },
                { word: "tomorrow", phonetic: "/tÉ™ËˆmÉ’roÊŠ/", chinese: "æ˜å¤©", category: "æ—¶é—´", example: "See you tomorrow.", exampleCn: "æ˜å¤©è§ã€‚" },
                { word: "yesterday", phonetic: "/ËˆjestÉ™rdeÉª/", chinese: "æ˜¨å¤©", category: "æ—¶é—´", example: "I saw him yesterday.", exampleCn: "æˆ‘æ˜¨å¤©è§åˆ°ä»–äº†ã€‚" },
                { word: "name", phonetic: "/neÉªm/", chinese: "åå­—", category: "ä»‹ç»", example: "My name is Tom.", exampleCn: "æˆ‘å«æ±¤å§†ã€‚" },
                { word: "friend", phonetic: "/frend/", chinese: "æœ‹å‹", category: "äººç‰©", example: "She is my friend.", exampleCn: "å¥¹æ˜¯æˆ‘çš„æœ‹å‹ã€‚" }
            ],
            weather: [
                { word: "weather", phonetic: "/ËˆweÃ°É™r/", chinese: "å¤©æ°”", category: "å¤©æ°”", example: "How's the weather?", exampleCn: "å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ" },
                { word: "sunny", phonetic: "/ËˆsÊŒni/", chinese: "æ™´æœ—çš„", category: "å¤©æ°”", example: "It's sunny today.", exampleCn: "ä»Šå¤©æ˜¯æ™´å¤©ã€‚" },
                { word: "cloudy", phonetic: "/ËˆklaÊŠdi/", chinese: "å¤šäº‘çš„", category: "å¤©æ°”", example: "It's cloudy.", exampleCn: "å¤šäº‘ã€‚" },
                { word: "rainy", phonetic: "/ËˆreÉªni/", chinese: "ä¸‹é›¨çš„", category: "å¤©æ°”", example: "It's rainy.", exampleCn: "åœ¨ä¸‹é›¨ã€‚" },
                { word: "cold", phonetic: "/koÊŠld/", chinese: "å†·çš„", category: "å¤©æ°”", example: "It's very cold.", exampleCn: "å¾ˆå†·ã€‚" },
                { word: "hot", phonetic: "/hÉ’t/", chinese: "çƒ­çš„", category: "å¤©æ°”", example: "It's hot today.", exampleCn: "ä»Šå¤©å¾ˆçƒ­ã€‚" },
                { word: "warm", phonetic: "/wÉ”Ërm/", chinese: "æ¸©æš–çš„", category: "å¤©æ°”", example: "Spring is warm.", exampleCn: "æ˜¥å¤©å¾ˆæ¸©æš–ã€‚" },
                { word: "cool", phonetic: "/kuËl/", chinese: "å‡‰çˆ½çš„", category: "å¤©æ°”", example: "The air is cool.", exampleCn: "ç©ºæ°”å¾ˆå‡‰çˆ½ã€‚" },
                { word: "wind", phonetic: "/wÉªnd/", chinese: "é£", category: "å¤©æ°”", example: "The wind is strong.", exampleCn: "é£å¾ˆå¤§ã€‚" },
                { word: "snow", phonetic: "/snoÊŠ/", chinese: "é›ª", category: "å¤©æ°”", example: "I love snow.", exampleCn: "æˆ‘å–œæ¬¢é›ªã€‚" },
                { word: "rain", phonetic: "/reÉªn/", chinese: "é›¨", category: "å¤©æ°”", example: "I like rain.", exampleCn: "æˆ‘å–œæ¬¢é›¨ã€‚" },
                { word: "umbrella", phonetic: "/ÊŒmËˆbrelÉ™/", chinese: "é›¨ä¼", category: "ç‰©å“", example: "Take your umbrella.", exampleCn: "å¸¦ä¸Šä½ çš„ä¼ã€‚" },
                { word: "temperature", phonetic: "/ËˆtemprÉ™tÊƒÉ™r/", chinese: "æ¸©åº¦", category: "å¤©æ°”", example: "The temperature is 25.", exampleCn: "æ¸©åº¦æ˜¯25åº¦ã€‚" },
                { word: "season", phonetic: "/ËˆsiËzn/", chinese: "å­£èŠ‚", category: "æ—¶é—´", example: "What's your favorite season?", exampleCn: "ä½ æœ€å–œæ¬¢å“ªä¸ªå­£èŠ‚ï¼Ÿ" },
                { word: "spring", phonetic: "/sprÉªÅ‹/", chinese: "æ˜¥å¤©", category: "æ—¶é—´", example: "I love spring.", exampleCn: "æˆ‘å–œæ¬¢æ˜¥å¤©ã€‚" }
            ],
            restaurant: [
                { word: "restaurant", phonetic: "/ËˆrestrÉ’nt/", chinese: "é¤å…", category: "åœºæ‰€", example: "Let's go to a restaurant.", exampleCn: "æˆ‘ä»¬å»é¤å…å§ã€‚" },
                { word: "menu", phonetic: "/ËˆmenjuË/", chinese: "èœå•", category: "é¤å…", example: "Can I see the menu?", exampleCn: "æˆ‘èƒ½çœ‹çœ‹èœå•å—ï¼Ÿ" },
                { word: "order", phonetic: "/ËˆÉ”ËrdÉ™r/", chinese: "ç‚¹èœ", category: "åŠ¨ä½œ", example: "I'd like to order.", exampleCn: "æˆ‘æƒ³ç‚¹é¤ã€‚" },
                { word: "waiter", phonetic: "/ËˆweÉªtÉ™r/", chinese: "æœåŠ¡å‘˜", category: "äººç‰©", example: "Excuse me, waiter!", exampleCn: "æœåŠ¡å‘˜ï¼" },
                { word: "bill", phonetic: "/bÉªl/", chinese: "è´¦å•", category: "é¤å…", example: "Can I have the bill?", exampleCn: "ä¹°å•ã€‚" },
                { word: "delicious", phonetic: "/dÉªËˆlÉªÊƒÉ™s/", chinese: "ç¾å‘³çš„", category: "å½¢å®¹è¯", example: "This is delicious!", exampleCn: "çœŸç¾å‘³ï¼" },
                { word: "hungry", phonetic: "/ËˆhÊŒÅ‹É¡ri/", chinese: "é¥¥é¥¿çš„", category: "æ„Ÿè§‰", example: "I'm hungry.", exampleCn: "æˆ‘é¥¿äº†ã€‚" },
                { word: "thirsty", phonetic: "/ËˆÎ¸ÉœËrsti/", chinese: "å£æ¸´çš„", category: "æ„Ÿè§‰", example: "I'm thirsty.", exampleCn: "æˆ‘æ¸´äº†ã€‚" },
                { word: "breakfast", phonetic: "/ËˆbrekfÉ™st/", chinese: "æ—©é¤", category: "é¤é£Ÿ", example: "What's for breakfast?", exampleCn: "æ—©é¤åƒä»€ä¹ˆï¼Ÿ" },
                { word: "lunch", phonetic: "/lÊŒntÊƒ/", chinese: "åˆé¤", category: "é¤é£Ÿ", example: "Let's have lunch.", exampleCn: "åƒåˆé¤å§ã€‚" },
                { word: "dinner", phonetic: "/ËˆdÉªnÉ™r/", chinese: "æ™šé¤", category: "é¤é£Ÿ", example: "What's for dinner?", exampleCn: "æ™šé¤åƒä»€ä¹ˆï¼Ÿ" },
                { word: "drink", phonetic: "/drÉªÅ‹k/", chinese: "é¥®æ–™ï¼›å–", category: "é¤é¥®", example: "What would you like to drink?", exampleCn: "ä½ æƒ³å–ä»€ä¹ˆï¼Ÿ" },
                { word: "coffee", phonetic: "/ËˆkÉ’fi/", chinese: "å’–å•¡", category: "é¥®æ–™", example: "I need coffee.", exampleCn: "æˆ‘éœ€è¦å’–å•¡ã€‚" },
                { word: "tea", phonetic: "/tiË/", chinese: "èŒ¶", category: "é¥®æ–™", example: "Would you like tea?", exampleCn: "æƒ³å–èŒ¶å—ï¼Ÿ" },
                { word: "water", phonetic: "/ËˆwÉ”ËtÉ™r/", chinese: "æ°´", category: "é¥®æ–™", example: "A glass of water, please.", exampleCn: "è¯·ç»™æˆ‘ä¸€æ¯æ°´ã€‚" }
            ],
            directions: [
                { word: "where", phonetic: "/wer/", chinese: "å“ªé‡Œ", category: "ç–‘é—®è¯", example: "Where is the bank?", exampleCn: "é“¶è¡Œåœ¨å“ªé‡Œï¼Ÿ" },
                { word: "left", phonetic: "/left/", chinese: "å·¦è¾¹", category: "æ–¹å‘", example: "Turn left.", exampleCn: "å·¦è½¬ã€‚" },
                { word: "right", phonetic: "/raÉªt/", chinese: "å³è¾¹", category: "æ–¹å‘", example: "Turn right.", exampleCn: "å³è½¬ã€‚" },
                { word: "straight", phonetic: "/streÉªt/", chinese: "ç›´èµ°", category: "æ–¹å‘", example: "Go straight.", exampleCn: "ç›´èµ°ã€‚" },
                { word: "near", phonetic: "/nÉªr/", chinese: "è¿‘çš„", category: "ä½ç½®", example: "It's near here.", exampleCn: "å°±åœ¨é™„è¿‘ã€‚" },
                { word: "far", phonetic: "/fÉ‘Ër/", chinese: "è¿œçš„", category: "ä½ç½®", example: "Is it far?", exampleCn: "è¿œå—ï¼Ÿ" },
                { word: "street", phonetic: "/striËt/", chinese: "è¡—é“", category: "åœºæ‰€", example: "Walk down this street.", exampleCn: "æ²¿è¿™æ¡è¡—èµ°ã€‚" },
                { word: "corner", phonetic: "/ËˆkÉ”ËrnÉ™r/", chinese: "æ‹è§’", category: "ä½ç½®", example: "It's on the corner.", exampleCn: "åœ¨æ‹è§’å¤„ã€‚" },
                { word: "across", phonetic: "/É™ËˆkrÉ’s/", chinese: "å¯¹é¢", category: "ä½ç½®", example: "It's across the street.", exampleCn: "åœ¨è¡—å¯¹é¢ã€‚" },
                { word: "next", phonetic: "/nekst/", chinese: "æ—è¾¹", category: "ä½ç½®", example: "It's next to the bank.", exampleCn: "åœ¨é“¶è¡Œæ—è¾¹ã€‚" },
                { word: "between", phonetic: "/bÉªËˆtwiËn/", chinese: "åœ¨...ä¹‹é—´", category: "ä½ç½®", example: "It's between A and B.", exampleCn: "åœ¨Aå’ŒBä¹‹é—´ã€‚" },
                { word: "map", phonetic: "/mÃ¦p/", chinese: "åœ°å›¾", category: "ç‰©å“", example: "Do you have a map?", exampleCn: "æœ‰åœ°å›¾å—ï¼Ÿ" },
                { word: "station", phonetic: "/ËˆsteÉªÊƒn/", chinese: "è½¦ç«™", category: "åœºæ‰€", example: "Where is the station?", exampleCn: "è½¦ç«™åœ¨å“ªï¼Ÿ" },
                { word: "stop", phonetic: "/stÉ’p/", chinese: "ç«™", category: "äº¤é€š", example: "Get off at the next stop.", exampleCn: "ä¸‹ä¸€ç«™ä¸‹è½¦ã€‚" },
                { word: "walk", phonetic: "/wÉ”Ëk/", chinese: "èµ°è·¯", category: "åŠ¨ä½œ", example: "It's a 5-minute walk.", exampleCn: "æ­¥è¡Œ5åˆ†é’Ÿã€‚" }
            ],
            shopping: [
                { word: "shop", phonetic: "/ÊƒÉ’p/", chinese: "å•†åº—", category: "åœºæ‰€", example: "I love to shop.", exampleCn: "æˆ‘å–œæ¬¢è´­ç‰©ã€‚" },
                { word: "buy", phonetic: "/baÉª/", chinese: "ä¹°", category: "åŠ¨ä½œ", example: "I want to buy this.", exampleCn: "æˆ‘æƒ³ä¹°è¿™ä¸ªã€‚" },
                { word: "sell", phonetic: "/sel/", chinese: "å–", category: "åŠ¨ä½œ", example: "They sell fruit.", exampleCn: "ä»–ä»¬å–æ°´æœã€‚" },
                { word: "price", phonetic: "/praÉªs/", chinese: "ä»·æ ¼", category: "è´­ç‰©", example: "What's the price?", exampleCn: "å¤šå°‘é’±ï¼Ÿ" },
                { word: "cheap", phonetic: "/tÊƒiËp/", chinese: "ä¾¿å®œçš„", category: "å½¢å®¹è¯", example: "This is cheap.", exampleCn: "è¿™ä¸ªä¾¿å®œã€‚" },
                { word: "expensive", phonetic: "/ÉªkËˆspensÉªv/", chinese: "æ˜‚è´µçš„", category: "å½¢å®¹è¯", example: "It's too expensive.", exampleCn: "å¤ªè´µäº†ã€‚" },
                { word: "money", phonetic: "/ËˆmÊŒni/", chinese: "é’±", category: "è´­ç‰©", example: "I have no money.", exampleCn: "æˆ‘æ²¡é’±äº†ã€‚" },
                { word: "pay", phonetic: "/peÉª/", chinese: "ä»˜æ¬¾", category: "åŠ¨ä½œ", example: "Can I pay by card?", exampleCn: "å¯ä»¥åˆ·å¡å—ï¼Ÿ" },
                { word: "cash", phonetic: "/kÃ¦Êƒ/", chinese: "ç°é‡‘", category: "è´­ç‰©", example: "I only have cash.", exampleCn: "æˆ‘åªæœ‰ç°é‡‘ã€‚" },
                { word: "card", phonetic: "/kÉ‘Ërd/", chinese: "é“¶è¡Œå¡", category: "è´­ç‰©", example: "Do you accept cards?", exampleCn: "æ¥å—åˆ·å¡å—ï¼Ÿ" },
                { word: "size", phonetic: "/saÉªz/", chinese: "å°ºå¯¸", category: "è´­ç‰©", example: "What size?", exampleCn: "ä»€ä¹ˆå°ºå¯¸ï¼Ÿ" },
                { word: "color", phonetic: "/ËˆkÊŒlÉ™r/", chinese: "é¢œè‰²", category: "è´­ç‰©", example: "What color?", exampleCn: "ä»€ä¹ˆé¢œè‰²ï¼Ÿ" },
                { word: "try", phonetic: "/traÉª/", chinese: "è¯•ç©¿", category: "åŠ¨ä½œ", example: "Can I try this?", exampleCn: "æˆ‘èƒ½è¯•è¯•å—ï¼Ÿ" },
                { word: "bag", phonetic: "/bÃ¦É¡/", chinese: "è¢‹å­", category: "ç‰©å“", example: "Do you need a bag?", exampleCn: "éœ€è¦è¢‹å­å—ï¼Ÿ" },
                { word: "change", phonetic: "/tÊƒeÉªndÊ’/", chinese: "é›¶é’±", category: "è´­ç‰©", example: "Here's your change.", exampleCn: "è¿™æ˜¯ä½ çš„é›¶é’±ã€‚" }
            ]
        };

        const quizData = [
            { sentence: "I want to ___ a cup of coffee.", answer: "drink", options: ["drink", "eat", "buy", "make"] },
            { sentence: "The weather is very ___ today.", answer: "cold", options: ["cold", "hot", "sunny", "happy"] },
            { sentence: "Can I have the ___, please?", answer: "bill", options: ["menu", "bill", "table", "water"] },
            { sentence: "Turn ___ at the corner.", answer: "left", options: ["left", "right", "up", "down"] },
            { sentence: "This bag is too ___.", answer: "expensive", options: ["cheap", "expensive", "big", "small"] }
        ];

        let currentUser = null;
        let allUsers = {};
        let appState = { currentTab: 'learn', currentWordIndex: 0, todayWords: [], selectedAnswer: null, currentQuizIndex: 0 };

        function loadAllUsers() {
            const saved = localStorage.getItem('vocabPlanet_users');
            if (saved) allUsers = JSON.parse(saved);
            renderUserList();
        }

        function saveAllUsers() { localStorage.setItem('vocabPlanet_users', JSON.stringify(allUsers)); }

        function renderUserList() {
            const userList = document.getElementById('userList');
            const userNames = Object.keys(allUsers);
            if (userNames.length === 0) { userList.innerHTML = '<div class="no-users">è¿˜æ²¡æœ‰ç”¨æˆ·ï¼Œåˆ›å»ºä¸€ä¸ªå§ï¼</div>'; return; }
            userList.innerHTML = userNames.map(name => {
                const user = allUsers[name];
                const learnedCount = user.learnedWords ? user.learnedWords.length : 0;
                return `<div class="user-item" onclick="loginUser('${name}')">
                    <div class="user-info"><div class="user-avatar">${name.charAt(0).toUpperCase()}</div>
                    <div><div class="user-name">${name}</div><div class="user-progress">å·²å­¦ ${learnedCount} ä¸ªå•è¯</div></div></div>
                    <button class="user-delete" onclick="event.stopPropagation(); deleteUser('${name}')">Ã—</button></div>`;
            }).join('');
        }

        function createOrLoginUser() {
            const name = document.getElementById('usernameInput').value.trim();
            if (!name) { alert('è¯·è¾“å…¥ä½ çš„åå­—ï¼'); return; }
            if (!allUsers[name]) {
                allUsers[name] = { name, createdAt: new Date().toISOString(), currentWordIndex: 0, todayWords: [], learnedWords: [], masteredWords: [], streakDays: 0, lastStudyDate: null, settings: { dailyWords: 15, accent: 'us' }, currentQuizIndex: 0 };
                saveAllUsers();
            }
            loginUser(name);
        }

        function loginUser(name) {
            currentUser = name;
            localStorage.setItem('vocabPlanet_currentUser', name);
            updateStreak();
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('appContainer').classList.add('active');
            updateHeaderUser();
            loadUserState();
            prepareTodayWords();
            updateUI();
            setupVocabTooltips();
            loadQuiz();
        }

        function updateStreak() {
            const user = allUsers[currentUser];
            const today = new Date().toDateString();
            if (user.lastStudyDate) {
                const lastDate = new Date(user.lastStudyDate).toDateString();
                const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
                if (lastDate !== today) {
                    user.streakDays = lastDate === yesterday.toDateString() ? user.streakDays + 1 : 1;
                }
            } else { user.streakDays = 1; }
            user.lastStudyDate = new Date().toISOString();
            saveAllUsers();
        }

        function updateHeaderUser() {
            document.getElementById('headerAvatar').textContent = currentUser.charAt(0).toUpperCase();
            document.getElementById('headerUsername').textContent = currentUser;
            document.getElementById('settingsUsername').textContent = currentUser;
        }

        function deleteUser(name) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤ç”¨æˆ· "${name}" å—ï¼Ÿ`)) { delete allUsers[name]; saveAllUsers(); renderUserList(); }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('vocabPlanet_currentUser');
            document.getElementById('appContainer').classList.remove('active');
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('usernameInput').value = '';
            toggleSettings();
            renderUserList();
        }

        function loadUserState() {
            const user = allUsers[currentUser];
            appState.currentWordIndex = user.currentWordIndex || 0;
            appState.todayWords = user.todayWords || [];
            appState.currentQuizIndex = user.currentQuizIndex || 0;
            document.getElementById('dailyWordsSlider').value = user.settings.dailyWords;
            document.getElementById('dailyWordsValue').textContent = user.settings.dailyWords;
            document.getElementById('accent').value = user.settings.accent;
        }

        function prepareTodayWords() {
            const user = allUsers[currentUser];
            const today = new Date().toDateString();
            const lastDate = user.lastStudyDate ? new Date(user.lastStudyDate).toDateString() : null;
            if (lastDate !== today || appState.todayWords.length === 0) {
                const allWords = Object.values(vocabulary).flat();
                const unlearnedWords = allWords.filter(w => !user.learnedWords.includes(w.word));
                appState.todayWords = unlearnedWords.slice(0, user.settings.dailyWords);
                appState.currentWordIndex = 0;
                user.todayWords = appState.todayWords;
                user.currentWordIndex = 0;
                saveAllUsers();
            }
            document.getElementById('totalWords').textContent = appState.todayWords.length;
        }

        function updateUI() {
            const user = allUsers[currentUser];
            document.getElementById('streakDays').textContent = user.streakDays || 0;
            document.getElementById('learnedCount').textContent = user.learnedWords.length;
            document.getElementById('masteredCount').textContent = user.masteredWords.length;
            document.getElementById('todayCount').textContent = appState.currentWordIndex;
            const progress = ((user.learnedWords.length / 3000) * 100).toFixed(1);
            document.getElementById('progressPercent').textContent = progress;
            document.getElementById('progressFill').style.width = progress + '%';
            updateWordCard();
        }

        function updateWordCard() {
            if (appState.currentWordIndex >= appState.todayWords.length) { showCompletion(); return; }
            const word = appState.todayWords[appState.currentWordIndex];
            document.getElementById('currentWordIndex').textContent = appState.currentWordIndex + 1;
            document.getElementById('wordEnglish').textContent = word.word;
            document.getElementById('wordPhonetic').textContent = word.phonetic;
            document.getElementById('wordChinese').textContent = word.chinese;
            document.getElementById('wordCategory').textContent = word.category;
            document.getElementById('exampleEnglish').innerHTML = word.example.replace(new RegExp(`(${word.word})`, 'gi'), '<span class="highlight">$1</span>');
            document.getElementById('exampleChinese').textContent = word.exampleCn;
        }

        function switchTab(tab) {
            appState.currentTab = tab;
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.getElementById(`section-${tab}`).classList.add('active');
        }

        function markWord(status) {
            const user = allUsers[currentUser];
            const word = appState.todayWords[appState.currentWordIndex];
            if (status === 'know' && !user.learnedWords.includes(word.word)) user.learnedWords.push(word.word);
            appState.currentWordIndex++;
            user.currentWordIndex = appState.currentWordIndex;
            saveAllUsers();
            updateUI();
        }

        function speakWord() {
            const word = appState.todayWords[appState.currentWordIndex];
            const user = allUsers[currentUser];
            if (word && 'speechSynthesis' in window) {
                const u = new SpeechSynthesisUtterance(word.word);
                u.lang = user.settings.accent === 'us' ? 'en-US' : 'en-GB';
                u.rate = 0.8;
                speechSynthesis.speak(u);
            }
        }

        function startScenario(scenario) {
            if (vocabulary[scenario]) {
                appState.todayWords = vocabulary[scenario];
                appState.currentWordIndex = 0;
                document.getElementById('totalWords').textContent = appState.todayWords.length;
                switchTab('learn');
                updateWordCard();
            }
        }

        function loadQuiz() {
            const quiz = quizData[appState.currentQuizIndex % quizData.length];
            document.getElementById('quizSentence').innerHTML = quiz.sentence.replace('___', '<span class="blank"></span>');
            document.getElementById('quizOptions').innerHTML = quiz.options.map(opt => `<button class="quiz-option" onclick="selectOption(this, '${opt}')">${opt}</button>`).join('');
            appState.selectedAnswer = null;
        }

        function selectOption(el, answer) {
            document.querySelectorAll('.quiz-option').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
            appState.selectedAnswer = answer;
        }

        function checkAnswer() {
            if (!appState.selectedAnswer) { alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç­”æ¡ˆï¼'); return; }
            const quiz = quizData[appState.currentQuizIndex % quizData.length];
            document.querySelectorAll('.quiz-option').forEach(o => {
                if (o.textContent === quiz.answer) o.classList.add('correct');
                else if (o.classList.contains('selected')) o.classList.add('wrong');
            });
            setTimeout(() => { appState.currentQuizIndex++; allUsers[currentUser].currentQuizIndex = appState.currentQuizIndex; saveAllUsers(); loadQuiz(); }, 1500);
        }

        function skipQuiz() { appState.currentQuizIndex++; allUsers[currentUser].currentQuizIndex = appState.currentQuizIndex; saveAllUsers(); loadQuiz(); }

        function setupVocabTooltips() {
            document.querySelectorAll('.vocab-word').forEach(w => {
                w.addEventListener('click', function() {
                    const tooltip = document.getElementById('vocabTooltip');
                    tooltip.querySelector('#tooltipWord').textContent = this.dataset.word;
                    tooltip.querySelector('#tooltipPhonetic').textContent = this.dataset.phonetic;
                    tooltip.querySelector('#tooltipMeaning').textContent = this.dataset.meaning;
                    const rect = this.getBoundingClientRect();
                    tooltip.style.left = rect.left + 'px';
                    tooltip.style.top = (rect.bottom + 10) + 'px';
                    tooltip.classList.add('show');
                    if ('speechSynthesis' in window) { const u = new SpeechSynthesisUtterance(this.dataset.word); u.lang = 'en-US'; u.rate = 0.8; speechSynthesis.speak(u); }
                });
            });
            document.addEventListener('click', e => { if (!e.target.classList.contains('vocab-word')) document.getElementById('vocabTooltip').classList.remove('show'); });
        }

        function toggleSettings() {
            document.getElementById('settingsPanel').classList.toggle('open');
            document.getElementById('settingsOverlay').classList.toggle('open');
        }

        function updateSliderValue(value) { document.getElementById('dailyWordsValue').textContent = value; }

        function saveSettings() {
            const user = allUsers[currentUser];
            user.settings.dailyWords = parseInt(document.getElementById('dailyWordsSlider').value);
            user.settings.accent = document.getElementById('accent').value;
            saveAllUsers();
            toggleSettings();
            appState.todayWords = [];
            appState.currentWordIndex = 0;
            prepareTodayWords();
            updateUI();
            alert('è®¾ç½®å·²ä¿å­˜ï¼');
        }

        function showCompletion() {
            document.getElementById('completionNew').textContent = appState.todayWords.length;
            document.getElementById('completionModal').classList.add('show');
        }

        function closeCompletion() {
            document.getElementById('completionModal').classList.remove('show');
            appState.todayWords = [];
            appState.currentWordIndex = 0;
            prepareTodayWords();
            updateUI();
        }

        function init() {
            loadAllUsers();
            const savedUser = localStorage.getItem('vocabPlanet_currentUser');
            if (savedUser && allUsers[savedUser]) loginUser(savedUser);
        }

        init();
    </script>
</body>
</html>
